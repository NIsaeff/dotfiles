// Niri configuration for Arch Linux Desktop
// AMD Ryzen 7 5800X 8-Core Processor
// AMD Radeon RX 6800/6800 XT / 6900 XT
// Dual monitor setup:
//   - HP 27xw (DP-3): 1920x1080 @ 60Hz (top, centered)
//   - LG QHD (DP-2): 2560x1440 @ 144Hz (bottom, primary)

input {
    keyboard {
        xkb {
            layout "us"
        }
        numlock
    }
    
    mouse {
        accel-speed 0.0
    }
}

output "DP-2" {
    mode "2560x1440@144.000"
    scale 1.0
    transform "normal"
    position x=0 y=1080
}

output "DP-3" {
    mode "1920x1080@60.000"
    scale 1.0
    transform "normal"
    position x=320 y=0
}

layout {
    gaps 8
    center-focused-column "never"
    preset-column-widths {
        proportion 0.33333
        proportion 0.5
        proportion 0.75
    }
    default-column-width { proportion 0.5; }
}

prefer-no-csd

spawn-at-startup "waybar"
spawn-at-startup "mako"
spawn-at-startup "swaybg" "-i" "~/Pictures/wallpaper.jpg" "-m" "fill"

hotkey-overlay {
    skip-at-startup
}

binds {
    // Mod key is Super (Windows key)
    Mod+Shift+Slash { show-hotkey-overlay; }
    
    // Applications
    Mod+T { spawn "alacritty"; }
    Mod+Return { spawn "alacritty"; }
    Mod+D { spawn "fuzzel"; }
    Mod+B { spawn "brave" "--enable-features=UseOzonePlatform" "--ozone-platform=wayland"; }
    
    // Window management
    Mod+Q { close-window; }
    Mod+H { focus-column-left; }
    Mod+L { focus-column-right; }
    Mod+J { focus-window-or-workspace-down; }
    Mod+K { focus-window-or-workspace-up; }
    
    Mod+Shift+H { move-column-left; }
    Mod+Shift+L { move-column-right; }
    Mod+Shift+J { move-window-down-or-to-workspace-down; }
    Mod+Shift+K { move-window-up-or-to-workspace-up; }
    
    // Column management
    Mod+Comma { consume-window-into-column; }
    Mod+Period { expel-window-from-column; }
    Mod+Shift+Comma { consume-or-expel-window-left; }
    Mod+Shift+Period { consume-or-expel-window-right; }
    
    // Resizing
    Mod+R { switch-preset-column-width; }
    Mod+Shift+R { reset-window-height; }
    Mod+Ctrl+H { set-column-width "-10%"; }
    Mod+Ctrl+L { set-column-width "+10%"; }
    Mod+Ctrl+J { set-window-height "+10%"; }
    Mod+Ctrl+K { set-window-height "-10%"; }
    
    // Workspaces
    Mod+1 { focus-workspace 1; }
    Mod+2 { focus-workspace 2; }
    Mod+3 { focus-workspace 3; }
    Mod+4 { focus-workspace 4; }
    Mod+5 { focus-workspace 5; }
    
    // Workspace navigation (up/down) - now handled by J/K
    // Mod+U { focus-workspace-down; }
    // Mod+I { focus-workspace-up; }
    
    Mod+Shift+1 { move-window-to-workspace 1; }
    Mod+Shift+2 { move-window-to-workspace 2; }
    Mod+Shift+3 { move-window-to-workspace 3; }
    Mod+Shift+4 { move-window-to-workspace 4; }
    Mod+Shift+5 { move-window-to-workspace 5; }
    
    // Monitor management
    Mod+Shift+Left { move-window-to-monitor-left; }
    Mod+Shift+Right { move-window-to-monitor-right; }
    Mod+Shift+Up { move-window-to-monitor-up; }
    Mod+Shift+Down { move-window-to-monitor-down; }
    
    // Fullscreen and maximize
    Mod+F { maximize-column; }
    Mod+Shift+F { fullscreen-window; }
    
    // Screenshots (all save file + copy to clipboard)
    Mod+S { spawn "sh" "-c" "file=\"$HOME/Pictures/Screenshots/area-$(date +%Y%m%d_%H%M%S).png\" && grim -g \"$(slurp)\" \"$file\" && wl-copy < \"$file\" && notify-send 'Screenshot' 'Area saved & copied to clipboard'"; }
    Mod+Ctrl+S { spawn "sh" "-c" "file=\"$HOME/Pictures/Screenshots/window-$(date +%Y%m%d_%H%M%S).png\" && grim -g \"$(slurp -w)\" \"$file\" && wl-copy < \"$file\" && notify-send 'Screenshot' 'Window saved & copied to clipboard'"; }
    Mod+Alt+S { spawn "sh" "-c" "file=\"$HOME/Pictures/Screenshots/full-$(date +%Y%m%d_%H%M%S).png\" && grim \"$file\" && wl-copy < \"$file\" && notify-send 'Screenshot' 'Full screen saved & copied to clipboard'"; }
    
    // System controls
    Mod+Shift+E { quit; }
    Mod+Shift+P { power-off-monitors; }
    
    // Volume controls (if you have pipewire/pulseaudio)
    XF86AudioRaiseVolume { spawn "wpctl" "set-volume" "@DEFAULT_AUDIO_SINK@" "0.1+"; }
    XF86AudioLowerVolume { spawn "wpctl" "set-volume" "@DEFAULT_AUDIO_SINK@" "0.1-"; }
    XF86AudioMute { spawn "wpctl" "set-mute" "@DEFAULT_AUDIO_SINK@" "toggle"; }
    

    
    // Mouse scroll workspace switching
    Mod+WheelScrollDown { focus-workspace-down; }
    Mod+WheelScrollUp { focus-workspace-up; }
    
    // Horizontal scroll for column navigation (with modifier)
    Mod+WheelScrollLeft { focus-column-right; }
    Mod+WheelScrollRight { focus-column-left; }
    
    // Alternative: scroll without modifier (uncomment if preferred)
    // WheelScrollDown { focus-workspace-down; }
    // WheelScrollUp { focus-workspace-up; }
    
    // Floating window controls
    Mod+Space { toggle-window-floating; }
    Mod+Shift+Space { switch-focus-between-floating-and-tiling; }
    
    // Mouse drag to float (for Brave and other windows)
    // Note: Middle mouse button drag is handled by niri automatically
    
    // Column + workspace navigation  
    Mod+U { move-column-to-workspace-down; }
    Mod+I { move-column-to-workspace-up; }
    
    // Overview
    Mod+Tab { toggle-overview; }
}

// Window rules with transparency
window-rule {
    match app-id="firefox"
    default-column-width { proportion 0.75; }
    opacity 0.98
}

window-rule {
    match app-id="brave-browser"
    open-floating true
}

window-rule {
    match app-id="brave-personal"
    open-floating true
    focus-ring {
        width 3
        active-color "#22c55e"
        inactive-color "#16a34a"
    }
    border {
        width 2
        active-color "#22c55e"
        inactive-color "#16a34a"
    }
}

window-rule {
    match app-id="brave-work"
    open-floating true
    focus-ring {
        width 3
        active-color "#f59e0b"
        inactive-color "#d97706"
    }
    border {
        width 2
        active-color "#f59e0b"
        inactive-color "#d97706"
    }
}

// Alacritty always transparent (focused or not)
window-rule {
    match app-id="Alacritty"
    default-column-width { proportion 0.75; }
    opacity 0.85
    geometry-corner-radius 12
    clip-to-geometry true
    draw-border-with-background false
    
    // Re-enable focus effects without background
    focus-ring {
        width 3
        active-color "#7c3aed"
        inactive-color "#313244"
    }
    border {
        width 2
        active-color "#7c3aed"
        inactive-color "#313244"
    }
}

window-rule {
    match app-id="kitty"
    default-column-width { proportion 0.5; }
    opacity 0.92
    
    // Disable focus effects for transparency
    focus-ring {
        off
    }
    border {
        off
    }
}

window-rule {
    match app-id="org.gnome.Nautilus"
    opacity 0.9
    
    // Disable focus effects for transparency
    focus-ring {
        off
    }
    border {
        off
    }
}

window-rule {
    match app-id="code"
    opacity 0.96
    
    // Disable focus effects for transparency
    focus-ring {
        off
    }
    border {
        off
    }
}

// Default rounded corners for all windows
window-rule {
    geometry-corner-radius 12
    clip-to-geometry true
}

// Focus effects for non-transparent windows
window-rule {
    exclude app-id="Alacritty"
    exclude app-id="kitty" 
    exclude app-id="org.gnome.Nautilus"
    exclude app-id="code"
    exclude app-id="firefox"
    
    focus-ring {
        width 2
        active-color "#7c3aed"
        inactive-color "#313244"
    }
    border {
        width 1
        active-color "#7c3aed"
        inactive-color "#313244"
    }
}

cursor {
    xcursor-theme "Adwaita"
    xcursor-size 24
}

environment {
    QT_QPA_PLATFORM "wayland"
    DISPLAY ":0"
}


